function CatSync(){var e=l(),t=mode,a=new CAT4Web,n={},c="cat4web",o=null;function i(e){return r()[e]}function r(){var e={};return e[a.MODE_FM]="FM",e[a.MODE_AM]="AM",e[a.MODE_CW_U]="CW",e[a.MODE_CW_L]="CW",e[a.MODE_SSB_L]="LSB",e[a.MODE_SSB_U]="USB",e[a.MODE_DIG_L]="LSB",e[a.MODE_DIG_U]="USB",e}function l(){return Math.round(1e3*nominalfreq())}function u(){var e=n.rig;a.getMode(e)===a.MODE_FM&&$('[name="autoFM"]').prop("checked")&&$('.cat-sync-delta-row [name="deltaNum"][value="2"]').click(),a.getMode(e)!==a.MODE_SSB_L&&a.getMode(e)!==a.MODE_SSB_U||!$('[name="autoSSB"]').prop("checked")||$('.cat-sync-delta-row [name="deltaNum"][value="3"]').click(),a.getMode(e)!==a.MODE_CW_L&&a.getMode(e)!==a.MODE_CW_U||!$('[name="autoCW"]').prop("checked")||$('.cat-sync-delta-row [name="deltaNum"][value="4"]').click(),a.getMode(e)!==a.MODE_DIG_L&&a.getMode(e)!==a.MODE_DIG_U||!$('[name="autoPSK"]').prop("checked")||$('.cat-sync-delta-row [name="deltaNum"][value="5"]').click();var t=$('.cat-sync-delta-row [name="deltaNum"]:checked').val();return t?(n["delta"+t]||0)/1e3:0}function s(){localStorage.setItem("catSyncSettings",JSON.stringify(n))}function d(e){return!c||c===e}function m(e){c=e,o&&clearTimeout(o),o=setTimeout(function(){c=null},500)}function p(){$(".cat-sync-min").show(),$(".cat-sync-fully").hide()}window.onerror=function(e){-1!==e.indexOf("Failed to set the 'buffer' property on 'ConvolverNode'")&&(setmute(1),setTimeout(function(){setmute(0)},1e3))},a.onChangeFrequency=function(t,c){if(n.rig===t&&c&&d("cat4web")){m("cat4web");var o=(c/1e3+u()).toFixed(2);e=1e3*o,setfreqif(o),(mode=a.getMode(t))&&set_mode(i(mode))}},a.onChangeMode=function(e,t){n.rig===e&&t&&d("cat4web")&&(m("cat4web"),set_mode(i(t)))},a.onChangePTT=function(e,t){n.rig===e&&!n.txMonitor&&soundapplet&&(t?soundapplet.setvolume(0):$("#volumecontrol2").change())},a.onChangeStatus=function(e,t){e===n.rig&&($(".cat-sync-port-status").text(a.getStatusText(e)),$(".cat-sync-settings").toggle(t===a.STATUS_ONLINE)),0===e&&($(".cat-sync-port-status").text("Disabled"),$(".cat-sync-settings").toggle(!1))},this.start=function(){var c=setInterval(function(){document.ct&&(clearInterval(c),void 0===(n=JSON.parse(localStorage.getItem("catSyncSettings"))||{}).rig&&(n.rig=1),void 0===n.txMonitor&&(n.txMonitor=!1),n.deltaNum||(n.deltaNum=1),s(),a.reconnectTimeout=1e3,a.connect(),setInterval(function(){var c=l()-1e3*u();if(c!=e&&(n.rig&&a.isActive()&&d("websdr")&&(m("websdr"),a.setFrequency(n.rig,c)),e=c),mode!=t){if(n.rig&&a.isActive()&&d("websdr")){var o=function(e){if("CW"===e)return a.MODE_CW_U;var t=r();for(var n in t)if(t[n]==e)return n;return null}(mode);o&&(m("websdr"),a.setMode(n.rig,o))}t=mode}},100))},100)},a.onConnect=function(){!function(){$("body").append('<div class="cat-sync"><div class="cat-sync-min">CAT4Web</div><div class="cat-sync-fully"><div class="cat-sync-close">&times;</div><div class="cat-sync-header"><b>CAT4Web:</b> <span class="cat-sync-header-small">CAT features on the Web!</span></div><div class="cat-sync-port-status"></div><label><input type="radio" name="rig" value="1"> Rig1</label><label><input type="radio" name="rig" value="2"> Rig2</label><label><input type="radio" name="rig" value="0"> Off</label><div class="cat-sync-settings"><hr>Frequency Shift:<div class="cat-sync-delta-row"><input type="radio" name="deltaNum" value="1"><input type="number" name="delta1"> Hz </div><div class="cat-sync-delta-row"><input type="radio" name="deltaNum" value="2"><input type="number" name="delta2"> Hz <input type="checkbox" name="autoFM"> Auto FM</label></div><div class="cat-sync-delta-row"><input type="radio" name="deltaNum" value="3"><input type="number" name="delta3"> Hz <input type="checkbox" name="autoSSB"> Auto SSB</label></div><div class="cat-sync-delta-row"><input type="radio" name="deltaNum" value="4"><input type="number" name="delta4"> Hz <input type="checkbox" name="autoCW"> Auto CW</label></div><div class="cat-sync-delta-row"><input type="radio" name="deltaNum" value="5"><input type="number" name="delta5"> Hz <input type="checkbox" name="autoPSK"> Auto PSK</label></div><label><input type="checkbox" name="txMonitor"> TX monitor</label></div></div></div>'),$('.cat-sync [name="delta1"]').val(n.delta1||0),$('.cat-sync [name="delta2"]').val(n.delta2||0),$('.cat-sync [name="delta3"]').val(n.delta3||0),$('.cat-sync [name="delta4"]').val(n.delta4||0),$('.cat-sync [name="delta5"]').val(n.delta5||0),$('.cat-sync [name="deltaNum"][value="'+n.deltaNum+'"]').prop("checked",!0),$('.cat-sync [name="rig"][value="'+n.rig+'"]').prop("checked",!0),$('.cat-sync [name="txMonitor"]').prop("checked",n.txMonitor),$('.cat-sync [name="autoFM"]').prop("checked",n.autoFM),$('.cat-sync [name="autoSSB"]').prop("checked",n.autoSSB),$('.cat-sync [name="autoCW"]').prop("checked",n.autoCW),$('.cat-sync [name="autoPSK"]').prop("checked",n.autoPSK),n.hideBar&&p();$(".cat-sync").show(),$("body").on("change",".cat-sync input",function(){var e=$(this),t=null;switch(e.prop("type")){case"number":t=parseFloat(e.val());break;case"checkbox":t=e.prop("checked");break;case"radio":t=parseInt(e.val())}n[e.prop("name")]=t,-1!==e.attr("name").indexOf("delta")&&a.onChangeFrequency(n.rig,a.getFrequency(n.rig)),"rig"===e.attr("name")&&(t?(a.rig=t,a.onChangeStatus(n.rig,a.getStatus(n.rig)),a.onChangeFrequency(n.rig,a.getFrequency(n.rig)),a.onChangeMode(n.rig,a.getMode(n.rig))):(n.rig=0,a.onChangeStatus(n.rig,null))),s()}).on("click",".cat-sync .cat-sync-close",function(){p(),n.hideBar=!0,s()}).on("click",".cat-sync .cat-sync-min",function(){$(".cat-sync-min").hide(),$(".cat-sync-fully").show(),n.hideBar=!1,s()})}()},a.onDisconnect=function(){$(".cat-sync").remove()}}$(function(){(new CatSync).start()});