
//WebSDR HTML5 client side - Copyright 2013-2018, pa3fwm@websdr.org - all rights reserved
//Since the intended use of this code involves sending a copy to the client computer, I (PA3FWM) hereby allow making it available unmodified, via my original WebSDR server software, to original WebSDR clients. Other use, including distribution in part or entirety or as part of other software, or reverse engineering, is not allowed without my explicit prior permission.
//Hooks
!function(){var e,ce=null,fe=window.AudioContext||window.webkitAudioContext;if(fe){document.ct||(document.ct=new fe);try{e=document.ct.createConvolver}catch(e){}e||(document.ct=ce,sup_webaudio=!1)}var le=32768;function t(){function t(e){var t=e.outputBuffer.getChannelData(0),n=e.outputBuffer.length;for(L++,e=0;e<n;e++){var o,r=k[C],a=A*D/_;1<=(s+=a)&&(--s,k[C]=0,le<=++C&&(C-=le),o=k[C],p&&(r=(s*o+(a-s)*r)/a)),"undefined"!=typeof sysaud_hookdef&&(r=hook_sysaud(r,_,i)),t[e]=2e-5*r*i}W=(new Date).getTime(),e=(new Date).getTime(),!m||H<(n=e-m)&&(H=n),m=e,G&&0==t[0]&&q++}document.getElementById("soundappletdiv").innerHTML='<div onclick="var e=document.getElementById(\'soundappletdebug\'); e.style.display=(e.style.display==\'none\')?\'block\':\'none\';" style="max-width:400px; min-height:50px; border-style:solid; border-color:black; background-color:white; color:black; border-width:1px; margin:2px; padding:2px; /*font-family:sans-serif;*/ font-size:85%;">WebSDR HTML5 sound - Copyright 2007-2018, P.T. de Boer, pa3fwm@websdr.org<br><span id="soundappletdebug" style="display:none"></span></div><span id="debug2"></span>';var w,g,v,b,n,y,o,r,M,k=new Int16Array(le),B=0,C=6144,s=0,D=8e3,_=48e3,A=1,i=1,x=-1,T=0,S=[],z=this,I=ce,E=0,P=[-5504,-5248,-6016,-5760,-4480,-4224,-4992,-4736,-7552,-7296,-8064,-7808,-6528,-6272,-7040,-6784,-2752,-2624,-3008,-2880,-2240,-2112,-2496,-2368,-3776,-3648,-4032,-3904,-3264,-3136,-3520,-3392,-22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,-30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,-11008,-10496,-12032,-11520,-8960,-8448,-9984,-9472,-15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,-344,-328,-376,-360,-280,-264,-312,-296,-472,-456,-504,-488,-408,-392,-440,-424,-88,-72,-120,-104,-24,-8,-56,-40,-216,-200,-248,-232,-152,-136,-184,-168,-1376,-1312,-1504,-1440,-1120,-1056,-1248,-1184,-1888,-1824,-2016,-1952,-1632,-1568,-1760,-1696,-688,-656,-752,-720,-560,-528,-624,-592,-944,-912,-1008,-976,-816,-784,-880,-848,5504,5248,6016,5760,4480,4224,4992,4736,7552,7296,8064,7808,6528,6272,7040,6784,2752,2624,3008,2880,2240,2112,2496,2368,3776,3648,4032,3904,3264,3136,3520,3392,22016,20992,24064,23040,17920,16896,19968,18944,30208,29184,32256,31232,26112,25088,28160,27136,11008,10496,12032,11520,8960,8448,9984,9472,15104,14592,16128,15616,13056,12544,14080,13568,344,328,376,360,280,264,312,296,472,456,504,488,408,392,440,424,88,72,120,104,24,8,56,40,216,200,248,232,152,136,184,168,1376,1312,1504,1440,1120,1056,1248,1184,1888,1824,2016,1952,1632,1568,1760,1696,688,656,752,720,560,528,624,592,944,912,1008,976,816,784,880,848],e=[.0084619,36183e-8,20264e-8,-48621e-9,-36771e-8,-70991e-8,-.0010355,-.0012935,-.0014506,-.0014733,-.0013571,-.0011019,-74253e-8,-30836e-8,1358e-7,56517e-8,88996e-8,.0010664,.0010912,92941e-8,60906e-8,15494e-8,-37203e-8,-91186e-8,-.001389,-.0017416,-.0019133,-.0018764,-.0016225,-.0011768,-58255e-8,92361e-9,75528e-8,.0013306,.0017366,.0019135,.0018299,.0014834,90902e-8,16944e-8,-64513e-8,-.0014333,-.0020901,-.002526,-.0026728,-.0024998,-.0020096,-.0012556,-32129e-8,68312e-8,.0016291,.0023941,.0028705,.0029846,.002705,.0020504,.0010884,-70093e-9,-.0012848,-.0024011,-.0032709,-.0037692,-.0038134,-.0033791,-.0024966,-.0012601,18871e-8,.0016733,.0030042,.0040027,.0045239,.0044775,.0038421,.0026705,.0010869,-72511e-8,-.0025439,-.0041336,-.0052788,-.0058077,-.0056185,-.0046979,-.0031235,-.0010625,.0012472,.0035218,.005466,.0068099,.0073449,.0069525,.0056265,.0034784,73321e-8,-.0022942,-.005233,-.007697,-.0093357,-.0098779,-.0091724,-.0072151,-.0041599,-31209e-8,.0038988,.007962,.011341,.013538,.014156,.012956,.0099028,.0051811,-7971e-7,-.0074221,-.013934,-.019491,-.023251,-.024456,-.02252,-.017099,-.0081382,.0040987,.019038,.035829,.053411,.070595,.086169,.098999,.10813,.11288,.11288,.10813,.098999,.086169,.070595,.053411,.035829,.019038,.0040987,-.0081382,-.017099,-.02252,-.024456,-.023251,-.019491,-.013934,-.0074221,-7971e-7,.0051811,.0099028,.012956,.014156,.013538,.011341,.007962,.0038988,-31209e-8,-.0041599,-.0072151,-.0091724,-.0098779,-.0093357,-.007697,-.005233,-.0022942,73321e-8,.0034784,.0056265,.0069525,.0073449,.0068099,.005466,.0035218,.0012472,-.0010625,-.0031235,-.0046979,-.0056185,-.0058077,-.0052788,-.0041336,-.0025439,-72511e-8,.0010869,.0026705,.0038421,.0044775,.0045239,.0040027,.0030042,.0016733,18871e-8,-.0012601,-.0024966,-.0033791,-.0038134,-.0037692,-.0032709,-.0024011,-.0012848,-70093e-9,.0010884,.0020504,.002705,.0029846,.0028705,.0023941,.0016291,68312e-8,-32129e-8,-.0012556,-.0020096,-.0024998,-.0026728,-.002526,.0035218,.0012472,-.0010625,-.0031235,-.0046979,-.0056185,-.0058077,-.0052788,-.0041336,-.0025439,-72511e-8,.0010869,.0026705,.0038421,.0044775,.0045239,.0040027,.0030042,.0016733,18871e-8,-.0012601,-.0024966,-.0033791,-.0038134,-.0037692,-.0032709,-.0024011,-.0012848,-70093e-9,.0010884,.0020504,.002705,.0029846,.0028705,.0023941,.0016291,68312e-8,-32129e-8,-.0012556,-.0020096,-.0024998,-.0026728,-.002526,-.0020901,-.0014333,-64513e-8,16944e-8,90902e-8,.0014834,.0018299,.0019135,.0017366,.0013306,75528e-8,92361e-9,-58255e-8,-.0011768,-.0016225,-.0018764,-.0019133,-.0017416,-.001389,-91186e-8,-37203e-8,15494e-8,60906e-8,92941e-8,.0010912,.0010664,88996e-8,56517e-8,1358e-7,-30836e-8,-74253e-8,-.0011019,-.0013571,-.0014733,-.0014506,-.0012935,-.0010355,-70991e-8,-36771e-8,-48621e-9,20264e-8,36183e-8,.0084619],a=[-60729e-8,.005547,.0012025,55133e-8,16992e-8,-23195e-8,-59426e-8,-82206e-8,-84752e-8,-65061e-8,-26977e-8,20642e-8,65721e-8,96247e-8,.001032,83416e-8,40395e-8,-15769e-8,-71117e-8,-.0011087,-.0012377,-.0010475,-57139e-8,82522e-9,75058e-8,.001259,.001464,.0012963,77829e-8,28808e-9,-76962e-8,-.0014083,-.001713,-.0015833,-.001033,-18129e-8,76089e-8,.0015551,.0019797,.0019098,.0013313,37702e-8,-72555e-8,-.0016986,-.0022625,-.0022768,-.0016922,-63215e-8,6491e-7,.0018212,.002576,.0026933,.0021119,94722e-8,-52351e-8,-.0019315,-.0029037,-.0031646,-.002609,-.0013427,33954e-8,.0020171,.0032517,.0036965,.003196,.0018324,-80558e-9,-.0020711,-.0036212,-.004303,-.0038921,-.0024398,-27089e-8,.0020837,.0040178,.0050015,.0047273,.003197,74395e-8,-.0020419,-.0044463,-.0058212,-.0057441,-.0041549,-.0013781,.0019266,.004923,.0068105,.0070197,.0053925,.0022394,-.00171,-.0054734,-.0080484,-.0086754,-.0070524,-.0034446,.001345,.0061452,.0096921,.010951,.009402,.0052149,-73621e-8,-.0070399,-.012063,-.014353,-.013025,-.0080465,-32853e-8,.0084029,.015957,.020176,.019477,.013318,.0024682,-.010997,-.023996,-.032993,-.034705,-.026822,-.0085825,.018925,.052806,.088761,.12179,.14705,.16074,.16074,.14705,.12179,.088761,.052806,.018925,-.0085825,-.026822,-.034705,-.032993,-.023996,-.010997,.0024682,.013318,.019477,.020176,.015957,.0084029,-32853e-8,-.0080465,-.013025,-.014353,-.012063,-.0070399,-73621e-8,.0052149,.009402,.010951,.0096921,.0061452,.001345,-.0034446,-.0070524,-.0086754,-.0080484,-.0054734,-.00171,.0022394,.0053925,.0070197,.0068105,.004923,.0019266,-.0013781,-.0041549,-.0057441,-.0058212,-.0044463,-.0020419,74395e-8,.003197,.0047273,.0050015,.0040178,.0020837,-27089e-8,-.0024398,-.0038921,-.004303,-.0036212,-.0020711,-80558e-9,.0018324,.003196,.0036965,.0032517,.0020171,33954e-8,-.0013427,-.002609,-.0031646,-.0029037,-.0019315,-52351e-8,94722e-8,.0021119,.0026933,.002576,.0018212,6491e-7,-63215e-8,-.0016922,-.0022768,-.0022625,-.0016986,-72555e-8,37702e-8,.0013313,.0019098,.0019797,.0015551,76089e-8,-18129e-8,-.001033,-.0015833,-.001713,-.0014083,-76962e-8,28808e-9,77829e-8,.0012963,.001464,.001259,75058e-8,82522e-9,-57139e-8,-.0010475,-.0012377,-.0011087,-71117e-8,-15769e-8,40395e-8,83416e-8,.001032,96247e-8,65721e-8,20642e-8,-26977e-8,-65061e-8,-84752e-8,-82206e-8,-59426e-8,-23195e-8,16992e-8,55133e-8,.0012025,.005547,-60729e-8],u=[-.0057279,-355e-6,-34657e-8,-32265e-8,-28568e-8,-23281e-8,-1673e-7,-86773e-9,44005e-10,10817e-8,21895e-8,33872e-8,46081e-8,589e-6,71566e-8,85449e-8,96872e-8,.0010826,.0011887,.0012785,.0013539,.0014097,.0014451,.0014572,.0014449,.0014071,.0013429,.001253,.0011363,9944e-7,82476e-8,63679e-8,4284e-7,20073e-8,-3878e-8,-28944e-8,-54502e-8,-80225e-8,-.0010553,-.0012998,-.0015302,-.001742,-.00193,-.0020897,-.0022163,-.0023046,-.0023534,-.0023594,-.0023179,-.0022306,-.0020944,-.0019112,-.0016809,-.0014065,-.0010903,-73703e-8,-3507e-7,62545e-9,49677e-8,94413e-8,.0013968,.001847,.0022869,.0027056,.0030964,.003449,.0037558,.0040081,.0041989,.0043211,.0043693,.0043381,.0042245,.0040256,.0037411,.0033716,.0029193,.002387,.0017819,.0011093,37879e-8,-40024e-8,-.0012159,-.002056,-.0029064,-.0037527,-.0045791,-.0053699,-.0061082,-.006778,-.007363,-.0078475,-.0082153,-.0084535,-.0085479,-.0084873,-.0082614,-.007862,-.0072826,-.0065194,-.00557,-.0044354,-.0031181,-.0016241,39188e-9,.0018614,.00383,.0059296,.008144,.010454,.012839,.015277,.017745,.020218,.022673,.025085,.027427,.029676,.031808,.0338,.035631,.037279,.038728,.039961,.040964,.041727,.04224,.042498,.042498,.04224,.041727,.040964,.039961,.038728,.037279,.035631,.0338,.031808,.029676,.027427,.025085,.022673,.020218,.017745,.015277,.012839,.010454,.008144,.0059296,.00383,.0018614,39188e-9,-.0016241,-.0031181,-.0044354,-.00557,-.0065194,-.0072826,-.007862,-.0082614,-.0084873,-.0085479,-.0084535,-.0082153,-.0078475,-.007363,-.006778,-.0061082,-.0053699,-.0045791,-.0037527,-.0029064,-.002056,-.0012159,-40024e-8,37879e-8,.0011093,.0017819,.002387,.0029193,.0033716,.0037411,.0040256,.0042245,.0043381,.0043693,.0043211,.0041989,.0040081,.0037558,.003449,.0030964,.0027056,.0022869,.001847,.0013968,94413e-8,49677e-8,62545e-9,-3507e-7,-73703e-8,-.0010903,-.0014065,-.0016809,-.0019112,-.0020944,-.0022306,-.0023179,-.0023594,-.0023534,-.0023046,-.0022163,-.0020897,-.00193,-.001742,-.0015302,-.0012998,-.0010553,-80225e-8,-54502e-8,-28944e-8,-3878e-8,20073e-8,4284e-7,63679e-8,82476e-8,9944e-7,.0011363,.001253,.0013429,.0014071,.0014449,.0014572,.0014451,.0014097,.0013539,.0012785,.0011887,.0010826,96872e-8,85449e-8,71566e-8,589e-6,46081e-8,33872e-8,21895e-8,10817e-8,44005e-10,-86773e-9,-1673e-7,-23281e-8,-28568e-8,-32265e-8,-34657e-8,-355e-6,-.0057279],d=[14796e-9,54604e-8,10129e-8,-11334e-10,-13189e-8,-19395e-8,-13571e-8,21337e-9,18632e-8,25029e-8,15699e-8,-52509e-9,-2543e-7,-3138e-7,-1739e-7,97403e-9,33704e-8,38346e-8,18391e-8,-15855e-8,-43525e-8,-45776e-8,-18388e-8,23889e-8,55005e-8,53497e-8,17021e-8,-34174e-8,-68209e-8,-61268e-8,-13912e-8,46928e-8,83027e-8,68693e-8,86099e-9,-62455e-8,-99487e-8,-75513e-8,-67519e-10,81051e-8,.0011744,81167e-8,-10417e-8,-.0010287,-.001367,-85273e-8,25207e-8,.0012819,.0015701,87113e-8,-44169e-8,-.0015723,-.0017801,-86101e-8,6801e-7,.0019007,.0019933,81468e-8,-97311e-8,-.0022683,-.0022045,-7237e-7,.0013276,.0026763,.002408,57881e-8,-.0017511,-.0031255,-.0025968,-36912e-8,.0022518,.0036165,.0027634,82343e-9,-.0028398,-.0041506,-.0028982,29666e-8,.0035272,.0047294,.0029905,-78603e-8,-.0043296,-.0053562,-.0030274,.0014094,.0052683,.0060364,.0029929,-.0021982,-.0063734,-.0067797,-.0028658,.003197,.0076896,.0076028,.0026174,-.0044718,-.0092868,-.008534,-.0022054,.0061279,.01128,.0096244,.0015614,-.0083444,-.013874,-.010969,-56468e-8,.011455,.017461,.01276,-.0010262,-.016164,-.022908,-.015444,.0037854,.024249,.03255,.020318,-.0095077,-.041874,-.055528,-.033308,.02819,.11468,.19857,.25007,.25007,.19857,.11468,.02819,-.033308,-.055528,-.041874,-.0095077,.020318,.03255,.024249,.0037854,-.015444,-.022908,-.016164,-.0010262,.01276,.017461,.011455,-56468e-8,-.010969,-.013874,-.0083444,.0015614,.0096244,.01128,.0061279,-.0022054,-.008534,-.0092868,-.0044718,.0026174,.0076028,.0076896,.003197,-.0028658,-.0067797,-.0063734,-.0021982,.0029929,.0060364,.0052683,.0014094,-.0030274,-.0053562,-.0043296,-78603e-8,.0029905,.0047294,.0035272,29666e-8,-.0028982,-.0041506,-.0028398,82343e-9,.0027634,.0036165,.0022518,-36912e-8,-.0025968,-.0031255,-.0017511,57881e-8,.002408,.0026763,.0013276,-7237e-7,-.0022045,-.0022683,-97311e-8,81468e-8,.0019933,.0019007,6801e-7,-86101e-8,-.0017801,-.0015723,-44169e-8,87113e-8,.0015701,.0012819,25207e-8,-85273e-8,-.001367,-.0010287,-10417e-8,81167e-8,.0011744,81051e-8,-67519e-10,-75513e-8,-99487e-8,-62455e-8,86099e-9,68693e-8,83027e-8,46928e-8,-13912e-8,-61268e-8,-68209e-8,-34174e-8,17021e-8,53497e-8,55005e-8,23889e-8,-18388e-8,-45776e-8,-43525e-8,-15855e-8,18391e-8,38346e-8,33704e-8,97403e-9,-1739e-7,-3138e-7,-2543e-7,-52509e-9,15699e-8,25029e-8,18632e-8,21337e-9,-13571e-8,-19395e-8,-13189e-8,-11334e-10,10129e-8,54604e-8,14796e-9],c=[.0065862,-.0022838,-.0059202,-.0112239,-.0169697,-.0214685,-.022742,-.0189184,-.0086407,.0084932,.0316914,.0588926,.0870663,.1126093,.1320398,.1425063,.1425063,.1320398,.1126093,.0870663,.0588926,.0316914,.0084932,-.0086407,-.0189184,-.022742,-.0214685,-.0169697,-.0112239,-.0059202,-.0022838,.0065862],f=[-.0086492,-.0044524,-.0043664,-.0030946,-3094e-7,.0042348,.010627,.018809,.028525,.039333,.050605,.061655,.071697,.079997,.085925,.089013,.089013,.085925,.079997,.071697,.061655,.050605,.039333,.028525,.018809,.010627,.0042348,-3094e-7,-.0030946,-.0043664,-.0044524,-.0086492],l=[.0080236,.001488,-.0074204,-.0175495,-.0195816,-.0075536,.0136434,.0283156,.020311,-.0121801,-.0489419,-.0561146,-.0078976,.0922184,.2069483,.2833355,.2833355,.2069483,.0922184,-.0078976,-.0561146,-.0489419,-.0121801,.020311,.0283156,.0136434,-.0075536,-.0195816,-.0175495,-.0074204,.001488,.0080236],p=!0,R=1e3,h=!1,W=0,m=0,H=0,L=0,q=5,F=25,V=[],G=0,J=1,N=0,O=0,U=0,j=0,K=0,Q=0,X=0;if(b=document.ct){var Y=/firefox\/([0-9]+)/i.exec(navigator.userAgent);Y&&Y[1]<41&&(G=1),b.sampleRate=_;var _=b.sampleRate,Z=2*(Z=2048);srate=b.sampleRate;try{n=b.createScriptProcessor(Z,0,1)}catch(e){n=b.createJavaScriptNode(Z,1,1)}if(n.onaudioprocess=t,this.p=n,y=b.createConvolver(),n.connect(y),y.connect(b.destination),window.sup_android)(e=b.createBuffer(1,32,_)).getChannelData(0).set(c),V[0]=e,(e=b.createBuffer(1,32,_)).getChannelData(0).set(c),V[1]=e,(e=b.createBuffer(1,32,_)).getChannelData(0).set(f),V[2]=e,(e=b.createBuffer(1,32,_)).getChannelData(0).set(l),V[3]=e;else for((c=Math.round(_/48e3))<1&&(c=1),f=512*c,u=[a,e,u,d],a=0;a<u.length;a++){for(var l=u[a],$=[],e=0;e<l.length;e++)for(d=0;d<c;d++)$[e*c+d]=l[e];(e=b.createBuffer(1,f,_)).getChannelData(0).set($),V[a]=e}y.normalize=!1,y.buffer=V[0],G&&(r=b.createScriptProcessor(Z,1,1),n.connect(r),r.onaudioprocess=function(e){e=e.inputBuffer.getChannelData(0),h||(F?F--:0!=e[0]?q=5:--q||(q=5,F=25,G++,n.disconnect(),n.onaudioprocess=ce,(n=b.createScriptProcessor(Z,1,1)).onaudioprocess=t,(this.p=n).connect(y),n.connect(r)))})}else(M=new Audio)&&M.mozSetup?M.mozSetup(1,_):(M=ce,window.browsersupporterror&&window.browsersupporterror());var ee,te=0,ne=.3*_;doe=function(){if(M){var e=M.mozCurrentSampleOffset(),t=Math.round(ne-(N-e));0==te&&(0==e?t=Math.round(.05*_):(ne=(te=N)+Math.round(.05*_))<.25*_&&(ne=Math.round(.25*_)));for(var n=[],e=0;e<t;e++){var o,r=k[C],a=A*D/_;1<=(s+=a)&&(--s,k[C]=0,le<=++C&&(C-=le),o=k[C],p&&(r=(s*o+(a-s)*r)/a)),h&&(r=0),(r=2e-5*r*i)||(r=0),o=.044*(a=.044*r+.088*O+.044*U- -1.354*j-.53*K)+.088*j+.044*K- -1.354*Q-.53*X,U=O,O=r,K=j,j=a,X=Q,Q=o,n[e]=o,3==ee&&(n[e]=r)}W=(new Date).getTime(),t=M.mozWriteAudio(n),N+=t}};var oe,re,ae,$=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],se=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ie=0,ue=new WebSocket("ws://"+window.location.host+"/~~stream?v=11");ue.binaryType="arraybuffer";var de=500;ue.onmessage=function(e){b||doe();var t=(2*le+B-C-((new Date).getTime()-W)*D/1e3)%le;2*R<(de+=.01*(t-de))&&(C=(le+B-R)%le,t=de=R),1.002<(A=1+1e-5*(de-R))&&(A=1.002),A<.998&&(A=.998),adly=R,t=Math.round(t)+" "+Math.round(R)+" "+Math.round(de)+" "+Math.round(1e6*(A-1))+"<br>"+Math.round(D)+" "+ee+" "+Math.round(_),t+=b?" WebAudio":M?" MozAudio":" none",t+="<br>",G&&(t+=" FFbug "+(G-1)+"("+q+","+F+")"),t+="<br>"+L+" "+b.state,document.getElementById("soundappletdebug").innerHTML=t;var n,t=new Uint8Array(e.data);for(e=B,lastlen=t.length,n=0;n<t.length;n++){var o=0,r=0;if(240==(240&t[n]))smeter=256*(15&t[n])+t[n+1],z.smetercallback&&z.smetercallback(10*smeter),n++;else if(128==t[n]){for(var a,s=0;s<128;s++)k[B+s]=P[t[n+1+s]];for(le<=(B+=128)&&(B-=le),n+=128,a=0;a<20;a++)$[a]=se[a]=0;ie=0}else if(144<=t[n]&&t[n]<=223)r=4,o=2,re=14-(t[n]>>4);else if(128!=(128&t[n]))r=1,o=2;else if(129==t[n])0<(D=256*t[n+1]+t[n+2])?x=1:(x=0,stopall()),n+=2;else if(130==t[n])oe=256*t[n+1]+t[n+2],n+=2;else if(131==t[n])ae=t[n+1],(a=15&t[n+1])!=ee&&(ee=a,y&&(y.buffer=V[ee])),n++;else if(132==t[n]){for(s=0;s<128;s++)k[B+s]=0;for(le<=(B+=128)&&(B-=le),a=0;a<20;a++)$[a]=se[a]=0;ie=0}else 133==t[n]&&(i=16777216*(((15&t[n+1])<<16)+(t[n+2]<<8)+t[n+3])+(t[n+4]<<16)+(t[n+5]<<8)+t[n+6],s=t[n+1]>>4,z.truefreqcallback&&z.truefreqcallback(i,s),n+=6);if(2==o){for(o=0,a=16==(16&ae)?12:14;o<128;){var i=255&t[n+3]|(255&t[n+2])<<8|(255&t[n+1])<<16|(255&t[n+0])<<24,u=15-re,d=oe,c=[999,999,8,4,2,1,99,99];if((s=0)!=(i<<=r))for(;0==(2147483648&i)&&s<u;)i<<=1,s++;s<u?(u=s,s++,i<<=1):(u=i>>24&255,s+=8,i<<=8);var f=0;for(u>=c[re]&&f++,u>=c[re-1]&&f++,re-1<f&&(f=re-1),c=(i>>16&65535)>>17-re&-1<<f,c+=u<<re-1,0!=(i&1<<32-re+f)&&(c=~(c|=(1<<f)-1)),r+=s+re-f;8<=r;)n++,r-=8;for(s=i=0;s<20;s++)i+=$[s]*se[s];for(i=0<=(i|=0)?i>>12:i+4095>>12,c=(d=c*d+d/2)>>4,s=19;0<=s&&($[s]+=-($[s]>>7)+(se[s]*c>>a),0!=s);s--)se[s]=se[s-1];se[0]=i+d,s=se[0]+(ie>>4),ie=16==(16&ae)?0:ie+(se[0]<<4>>3),k[B++]=s,le<=B&&(B-=le),o++}0==r&&n--}}if("undefined"!=typeof webaud_hookdef){var l=B-e;B<e&&(l+=le);for(var p=0;p<l;p++){var h=p+e;le<=h&&(h-=le);var m=k[h];k[h]=hook_webaud(m,D,R)}}if(w)for(;e!=B;){for(v+=g/D;1<=v;)w.setInt16(T,k[e],!0),65536<=(T+=2)&&(t=new ArrayBuffer(65536),T=0,w=new DataView(t),S.push(t)),v--;le<=++e&&(e-=le)}I&&(B<E?(I.postMessage(k.subarray(E),"*"),E=0):E+1024<=B&&(I.postMessage(k.subarray(E,E+1024),"*"),E+=1024)),J&&((e=document.getElementById("audiostartbutton"))&&(e.style.display="suspended"===b.state?"block":"none"),"running"===b.state&&(J=0))},ue.onopen=function(){soundappletstarted()},ue.onclose=function(){for(var e=0;e<le;e++)k[e]=0;ue.onclose=ce,ue=ue.onmessage=ce},this.setparam=function(e){try{ue.send("GET /~~param?"+e)}catch(e){}},this.smeter=function(){return 10*smeter},this.getid=function(){return x},this.mute=function(){h=!h},this.setvolume=function(e){i=e},this.setdelay1=function(e){de=R=e,C=(le+B-R)%le},this.restartaudio=function(){stopall(),document.ct=new fe,window.prep_html5sound()},this.destroy=function(){stopall(),window.soundapplet=ce},this.rec_start=function(){g=D,v=T=0;var e=new ArrayBuffer(65536);w=new DataView(e),S=[e]},this.rec_finish=function(){S[S.length-1]=S[S.length-1].slice(0,T),w=ce;var e={};return e.wavdata=S,e.len=65536*(S.length-1)+T,e.sr=g,e},this.rec_length_kB=function(){return(65536*(S.length-1)+T)/1024},this.setbcaudio=function(e){I=e,E=B},this.setstereo=function(e){e<0?(y.disconnect(),y.connect(b.destination)):(o||(o=b.createChannelMerger()).connect(b.destination),y.disconnect(),y.connect(o,0,e))},this.audioresume=function(){b.resume();var e=document.getElementById("audiostartbutton");e&&(e.style.display="none"),J=0}}window.prep_html5sound=function(){window.soundapplet=new t},prep_html5sound()}();
